---
status: unstable
---

# Helper Definition DSLs

Helpers like Models and Actions can choose to use a special DSL that is available to them for building up their functionality.  The alternative would be ensuring that the helper module file exports the right type of object, so that the `Skypager.Registry` can properly route requests to the helper when needed.

All of this meta data generated by the definition can be used in a variety of ways.  It can be used to query the helper registries to only find actions or models which meet certain criteria, for example.

The `skypager-cli` module uses this to automatically expose certain actions via the CLI:

```js
  // the project can dynamically add its own cli commands from certain actions
  if (project && project.actions) {
    project.actions
    .filter(action => get(action, 'definition.interfaces.cli'))
    .forEach(action => get(action, 'definition.interfaces.cli').call(action, commander, dispatch))
  }
```

In the above code, the actions which have definitions that declare a CLI interface can be easily grouped together and accessed.

### Definitions

Definiton files can be found in [link:source](packages/skypager-project/src/helpers/definitions).

The way a definition object works is through the `Skypager.Registry` and its behavior where it loads a bunch of action files from a directory and attempts to register them.

After requiring an action file, it checks to see whether that script emitted an Action Definition object.  It uses this definition data when registering that module with the registry.

#### Action Definition

```js
export class ActionDefinition {
  static DSL = {};

  constructor (actionName) {
    this.name = actionName
    this.description = ''
    this.config = {}
    this.interfaces = {}
    this.parameters = { }
    this.aliases = {}
    this.validator = function () { return true }
    this.executor = function () { throw ('Define your own executor function') }
    this.config.pathMatchers = []
  }
  
}

assign(ActionDefinition.DSL, {
  action: function (actionName) {
    tracker[(_curr = tabelize(parameterize(actionName)))] = new ActionDefinition(actionName)
  },
  describe: function (...args) { tracker[_curr].describe(...args) },
  aliases: function (...args) { tracker[_curr].aliases(...args) },
  aka: function (...args) { tracker[_curr].aka(...args) },
  validate: function (...args) { tracker[_curr].validate(...args) },
  execute: function (...args) { tracker[_curr].execute(...args) },
  required: function (...args) { tracker[_curr].required(...args) },
  optional: function (...args) { tracker[_curr].optional(...args) },
  params: function (...args) { tracker[_curr].params(...args) },
  commandPhrase: function (...args) { tracker[_curr].addCommandPhrase(...args) },
  route: function (...args) { tracker[_curr].addRouteMatcher(...args) },
  expose: function(...args) { tracker[_curr].expose(...args) },
  cli: function(...args) { tracker[_curr].expose('cli', ...args) },
  ipc: function(...args) { tracker[_curr].expose('ipc', ...args) },
  web: function(...args) { tracker[_curr].expose('web', ...args) }
})
```

The methods and functions that are attached to the `ActionDefinition.DSL` object will be locally available to all action modules that get imported into the project via the `Skypager.Registry.load` method.


## Unstable API

The benefits of the DSL may not be worth the tradeoff in complexity.  Improved documentation and especially GUI interfaces to the project and helper system can improve this.

