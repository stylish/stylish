'use strict';

var debug = require('debug')('skypager:exporters');

function CollectionBundle() {
  var options = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

  try {} catch (e) {}

  var project = options.project || this;

  var bundle = {};

  var allAssets = project.allAssets || [];

  allAssets.forEach(function (asset) {
    try {
      if (!asset.raw) {
        asset.runImporter('disk', { sync: true });
      }
    } catch (e) {
      debug('collection bundle error: ' + asset.uri);
      throw e;
    }
  });

  allAssets.forEach(function (asset) {
    try {
      var entry = bundle[asset.paths.projectRequire] = {
        id: asset.id,
        uri: asset.uri,
        raw: asset.raw,
        fingerprint: asset.fingerprint,
        path: asset.paths.projectRequire
      };

      if (asset.assetClass.name == 'DataSource') {
        delete entry.raw;
        entry.data = asset.data;
      }
    } catch (e) {
      debug("Collection Bundle Asset Error", e.message);
      throw e;
    }
  });

  return bundle;
}

module.exports = CollectionBundle;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9leHBvcnRlcnMvY29sbGVjdGlvbl9idW5kbGUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFJLEtBQUssR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsb0JBQW9CLENBQUMsQ0FBQTs7QUFFbEQsU0FBUyxnQkFBZ0IsR0FBYztNQUFiLE9BQU8seURBQUcsRUFBRTs7QUFDcEMsTUFBSSxFQUVILENBQUMsT0FBTSxDQUFDLEVBQUUsRUFFVjs7QUFFRCxNQUFJLE9BQU8sR0FBRyxPQUFPLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQTs7QUFFckMsTUFBSSxNQUFNLEdBQUcsRUFBRyxDQUFBOztBQUVoQixNQUFJLFNBQVMsR0FBRyxPQUFPLENBQUMsU0FBUyxJQUFJLEVBQUUsQ0FBQTs7QUFFckMsV0FBUyxDQUFDLE9BQU8sQ0FBQyxVQUFBLEtBQUssRUFBSTtBQUN6QixRQUFJO0FBQ0YsVUFBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUU7QUFBRSxhQUFLLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRSxFQUFDLElBQUksRUFBQyxJQUFJLEVBQUMsQ0FBQyxDQUFBO09BQUU7S0FDMUQsQ0FBQyxPQUFNLENBQUMsRUFBRTtBQUNULFdBQUssQ0FBQywyQkFBMkIsR0FBRyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUE7QUFDOUMsWUFBTSxDQUFDLENBQUM7S0FDVDtHQUNGLENBQUMsQ0FBQTs7QUFFSixXQUFTLENBQUMsT0FBTyxDQUFDLFVBQUEsS0FBSyxFQUFJO0FBQ3pCLFFBQUk7QUFDRixVQUFJLEtBQUssR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsR0FBRztBQUMvQyxVQUFFLEVBQUUsS0FBSyxDQUFDLEVBQUU7QUFDWixXQUFHLEVBQUUsS0FBSyxDQUFDLEdBQUc7QUFDZCxXQUFHLEVBQUUsS0FBSyxDQUFDLEdBQUc7QUFDZCxtQkFBVyxFQUFFLEtBQUssQ0FBQyxXQUFXO0FBQzlCLFlBQUksRUFBRSxLQUFLLENBQUMsS0FBSyxDQUFDLGNBQWM7T0FDakMsQ0FBQTs7QUFFRCxVQUFJLEtBQUssQ0FBQyxVQUFVLENBQUMsSUFBSSxJQUFJLFlBQVksRUFBRTtBQUN6QyxlQUFPLEtBQUssQ0FBQyxHQUFHLEFBQUMsQ0FBQTtBQUNqQixhQUFLLENBQUMsSUFBSSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUE7T0FDeEI7S0FFRixDQUFDLE9BQU0sQ0FBQyxFQUFFO0FBQ1QsV0FBSyxDQUFDLCtCQUErQixFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQTtBQUNqRCxZQUFNLENBQUMsQ0FBQztLQUNUO0dBQ0YsQ0FBQyxDQUFBOztBQUVGLFNBQU8sTUFBTSxDQUFBO0NBQ2Q7O0FBRUQsTUFBTSxDQUFDLE9BQU8sR0FBRyxnQkFBZ0IsQ0FBQSIsImZpbGUiOiJjb2xsZWN0aW9uX2J1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBkZWJ1ZyA9IHJlcXVpcmUoJ2RlYnVnJykoJ3NreXBhZ2VyOmV4cG9ydGVycycpXG5cbmZ1bmN0aW9uIENvbGxlY3Rpb25CdW5kbGUob3B0aW9ucyA9IHt9KXtcbiAgdHJ5IHtcblxuICB9IGNhdGNoKGUpIHtcblxuICB9XG5cbiAgbGV0IHByb2plY3QgPSBvcHRpb25zLnByb2plY3QgfHwgdGhpc1xuXG4gIGxldCBidW5kbGUgPSB7IH1cblxuICBsZXQgYWxsQXNzZXRzID0gcHJvamVjdC5hbGxBc3NldHMgfHwgW11cblxuICAgIGFsbEFzc2V0cy5mb3JFYWNoKGFzc2V0ID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGlmKCFhc3NldC5yYXcpIHsgYXNzZXQucnVuSW1wb3J0ZXIoJ2Rpc2snLCB7c3luYzp0cnVlfSkgfVxuICAgICAgfSBjYXRjaChlKSB7XG4gICAgICAgIGRlYnVnKCdjb2xsZWN0aW9uIGJ1bmRsZSBlcnJvcjogJyArIGFzc2V0LnVyaSlcbiAgICAgICAgdGhyb3coZSlcbiAgICAgIH1cbiAgICB9KVxuXG4gIGFsbEFzc2V0cy5mb3JFYWNoKGFzc2V0ID0+IHtcbiAgICB0cnkge1xuICAgICAgbGV0IGVudHJ5ID0gYnVuZGxlW2Fzc2V0LnBhdGhzLnByb2plY3RSZXF1aXJlXSA9IHtcbiAgICAgICAgaWQ6IGFzc2V0LmlkLFxuICAgICAgICB1cmk6IGFzc2V0LnVyaSxcbiAgICAgICAgcmF3OiBhc3NldC5yYXcsXG4gICAgICAgIGZpbmdlcnByaW50OiBhc3NldC5maW5nZXJwcmludCxcbiAgICAgICAgcGF0aDogYXNzZXQucGF0aHMucHJvamVjdFJlcXVpcmVcbiAgICAgIH1cblxuICAgICAgaWYgKGFzc2V0LmFzc2V0Q2xhc3MubmFtZSA9PSAnRGF0YVNvdXJjZScpIHtcbiAgICAgICAgZGVsZXRlKGVudHJ5LnJhdylcbiAgICAgICAgZW50cnkuZGF0YSA9IGFzc2V0LmRhdGFcbiAgICAgIH1cblxuICAgIH0gY2F0Y2goZSkge1xuICAgICAgZGVidWcoXCJDb2xsZWN0aW9uIEJ1bmRsZSBBc3NldCBFcnJvclwiLCBlLm1lc3NhZ2UpXG4gICAgICB0aHJvdyhlKVxuICAgIH1cbiAgfSlcblxuICByZXR1cm4gYnVuZGxlXG59XG5cbm1vZHVsZS5leHBvcnRzID0gQ29sbGVjdGlvbkJ1bmRsZVxuIl19