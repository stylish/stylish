'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.develop = develop;
exports.handle = handle;
exports.launchWatcher = launchWatcher;
exports.launchServer = launchServer;
exports.launchTunnel = launchTunnel;

var _path = require('path');

var _shelljs = require('shelljs');

var _shelljs2 = _interopRequireDefault(_shelljs);

var _util = require('../util');

var _util2 = _interopRequireDefault(_util);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function develop(program, dispatch) {
  program.command('dev [entry]').alias('develop').alias('dev-server').description('run a development server for this project').option('--port <port>', 'which port should this server listen on?', 3000).option('--host <hostname>', 'which hostname should this server listen on?', 'localhost').option('--entry <path>', 'relative path to the entry point', './src').option('--entry-name <name>', 'what to name the entry point script', 'app').option('--platform <name>', 'which platform are we building for? electron or web', 'web').option('--theme <name>', 'the name of the theme to use').option('--html-template-path <path>', 'path to the html template to use').option('--precompiled <name>', 'use a precompiled html template which includes vendor libs, themes, etc').option('--ngrok', 'when enabled, will attempt to use ngrok to expose a public API endpoint for this server').option('--ngrok-config <path>', 'path to a configuration file for the ngrok service').option('--silent', 'suppress any server output').option('--debug', 'show error info from the server').option('--dev-tools-path <path>', 'path to the skypager-devpack devtools library').option('--webpack-config <path>', 'path to a javascript function which can mutate the webpack config').option('--bundle', 'watch for content changes in the project and update the distribution bundle').option('--bundle-command', 'the command to run to generate the bundle default: skypager export bundle', 'skypager export bundle').option('--middleware <path>', 'apply express middleware to the dev-server').action(dispatch(handle));
}

exports.default = develop;
function handle(entry) {
  var options = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];
  var context = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];

  launchServer(entry, options, context);

  if (options.bundle) {
    console.log('watching assets for changes'.green);
    launchWatcher(options, context);
  }

  if (options.ngrok) {
    console.log('launching ngrok tunnel'.green);
    launchTunnel(options, context);
  }
}

function launchWatcher(options, context) {
  var project = context.project;

  var bundleCommand = options.bundleCommand || 'skypager export bundle';

  var proc = _shelljs2.default.exec('chokidar \'./{data,docs}/**/*.*\' --silent --debounce 1200 -c \'' + bundleCommand + '\'', { async: true });

  proc.stdout.on('data', function (data) {
    if (!options.silent) {
      console.log(data);
    }
  });

  proc.stderr.on('data', function (data) {
    if (options.debug) {
      console.log(data);
    }
  });
}

function launchServer(entry) {
  var options = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];
  var context = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];

  var project = context.project;

  options.entry = entry || options.entry || project.options.entry || './src';
  options.theme = options.theme || project.options.theme || 'marketing';

  options.staticAssets = options.staticAssets || project.options.staticAssets || {};

  require(pathToDevpack(options.devToolsPath) + '/webpack/server')(options);
}

function launchTunnel(options, context) {
  var server = _shelljs2.default.exec('ngrok http ' + (options.port || 3000), { async: true });

  server.stdout.on('data', function (data) {
    console.log(data);
  });

  server.stderr.on('data', function (data) {
    console.log(data);
  });

  server.on('end', function () {
    console.log('Ngrok tunnel ended');
  });
}

function pathToDevpack(opt) {
  return opt && (0, _path.resolve)(opt) || process.env.SKYPAGER_DEVPACK_PATH || (0, _path.dirname)(require.resolve('skypager-devpack'));
}

function isDepackInstalled() {
  try {
    return pathToDevpack();
  } catch (error) {
    return false;
  }
}
//# sourceMappingURL=data:application/json;base64,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QUE7O0FBRTlFLFFBQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxVQUFDLElBQUksRUFBSztBQUNqQyxXQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFBO0dBQ2xCLENBQUMsQ0FBQTs7QUFFRixRQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsVUFBQyxJQUFJLEVBQUs7QUFDakMsV0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQTtHQUNsQixDQUFDLENBQUE7O0FBRUYsUUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsWUFBTTtBQUNwQixXQUFPLENBQUMsR0FBRyxDQUFDLG9CQUFvQixDQUFDLENBQUE7R0FDbkMsQ0FBQyxDQUFBO0NBQ0g7O0FBRUQsU0FBUyxhQUFhLENBQUUsR0FBRyxFQUFFO0FBQUUsU0FBTyxBQUFDLEdBQUcsSUFBSSxVQTlGL0IsT0FBTyxFQThGZ0MsR0FBRyxDQUFDLElBQUssT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsSUFBSSxVQTlGNUUsT0FBTyxFQThGOEUsT0FBTyxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUE7Q0FBRTs7QUFFbkosU0FBUyxpQkFBaUIsR0FBSTtBQUM1QixNQUFJO0FBQ0YsV0FBTyxhQUFhLEVBQUUsQ0FBQTtHQUN2QixDQUFDLE9BQU8sS0FBSyxFQUFFO0FBQ2QsV0FBTyxLQUFLLENBQUE7R0FDYjtDQUNGIiwiZmlsZSI6ImRldmVsb3AuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBqb2luLCByZXNvbHZlLCBkaXJuYW1lIH0gZnJvbSAncGF0aCdcblxuaW1wb3J0IHNoZWxsIGZyb20gJ3NoZWxsanMnXG5pbXBvcnQgdXRpbCBmcm9tICcuLi91dGlsJ1xuXG5leHBvcnQgZnVuY3Rpb24gZGV2ZWxvcCAocHJvZ3JhbSwgZGlzcGF0Y2gpIHtcbiAgcHJvZ3JhbVxuICAgIC5jb21tYW5kKCdkZXYgW2VudHJ5XScpXG4gICAgLmFsaWFzKCdkZXZlbG9wJylcbiAgICAuYWxpYXMoJ2Rldi1zZXJ2ZXInKVxuICAgIC5kZXNjcmlwdGlvbigncnVuIGEgZGV2ZWxvcG1lbnQgc2VydmVyIGZvciB0aGlzIHByb2plY3QnKVxuICAgIC5vcHRpb24oJy0tcG9ydCA8cG9ydD4nLCAnd2hpY2ggcG9ydCBzaG91bGQgdGhpcyBzZXJ2ZXIgbGlzdGVuIG9uPycsIDMwMDApXG4gICAgLm9wdGlvbignLS1ob3N0IDxob3N0bmFtZT4nLCAnd2hpY2ggaG9zdG5hbWUgc2hvdWxkIHRoaXMgc2VydmVyIGxpc3RlbiBvbj8nLCAnbG9jYWxob3N0JylcbiAgICAub3B0aW9uKCctLWVudHJ5IDxwYXRoPicsICdyZWxhdGl2ZSBwYXRoIHRvIHRoZSBlbnRyeSBwb2ludCcsICcuL3NyYycpXG4gICAgLm9wdGlvbignLS1lbnRyeS1uYW1lIDxuYW1lPicsICd3aGF0IHRvIG5hbWUgdGhlIGVudHJ5IHBvaW50IHNjcmlwdCcsICdhcHAnKVxuICAgIC5vcHRpb24oJy0tcGxhdGZvcm0gPG5hbWU+JywgJ3doaWNoIHBsYXRmb3JtIGFyZSB3ZSBidWlsZGluZyBmb3I/IGVsZWN0cm9uIG9yIHdlYicsICd3ZWInKVxuICAgIC5vcHRpb24oJy0tdGhlbWUgPG5hbWU+JywgJ3RoZSBuYW1lIG9mIHRoZSB0aGVtZSB0byB1c2UnKVxuICAgIC5vcHRpb24oJy0taHRtbC10ZW1wbGF0ZS1wYXRoIDxwYXRoPicsICdwYXRoIHRvIHRoZSBodG1sIHRlbXBsYXRlIHRvIHVzZScpXG4gICAgLm9wdGlvbignLS1wcmVjb21waWxlZCA8bmFtZT4nLCAndXNlIGEgcHJlY29tcGlsZWQgaHRtbCB0ZW1wbGF0ZSB3aGljaCBpbmNsdWRlcyB2ZW5kb3IgbGlicywgdGhlbWVzLCBldGMnKVxuICAgIC5vcHRpb24oJy0tbmdyb2snLCAnd2hlbiBlbmFibGVkLCB3aWxsIGF0dGVtcHQgdG8gdXNlIG5ncm9rIHRvIGV4cG9zZSBhIHB1YmxpYyBBUEkgZW5kcG9pbnQgZm9yIHRoaXMgc2VydmVyJylcbiAgICAub3B0aW9uKCctLW5ncm9rLWNvbmZpZyA8cGF0aD4nLCAncGF0aCB0byBhIGNvbmZpZ3VyYXRpb24gZmlsZSBmb3IgdGhlIG5ncm9rIHNlcnZpY2UnKVxuICAgIC5vcHRpb24oJy0tc2lsZW50JywgJ3N1cHByZXNzIGFueSBzZXJ2ZXIgb3V0cHV0JylcbiAgICAub3B0aW9uKCctLWRlYnVnJywgJ3Nob3cgZXJyb3IgaW5mbyBmcm9tIHRoZSBzZXJ2ZXInKVxuICAgIC5vcHRpb24oJy0tZGV2LXRvb2xzLXBhdGggPHBhdGg+JywgJ3BhdGggdG8gdGhlIHNreXBhZ2VyLWRldnBhY2sgZGV2dG9vbHMgbGlicmFyeScpXG4gICAgLm9wdGlvbignLS13ZWJwYWNrLWNvbmZpZyA8cGF0aD4nLCAncGF0aCB0byBhIGphdmFzY3JpcHQgZnVuY3Rpb24gd2hpY2ggY2FuIG11dGF0ZSB0aGUgd2VicGFjayBjb25maWcnKVxuICAgIC5vcHRpb24oJy0tYnVuZGxlJywgJ3dhdGNoIGZvciBjb250ZW50IGNoYW5nZXMgaW4gdGhlIHByb2plY3QgYW5kIHVwZGF0ZSB0aGUgZGlzdHJpYnV0aW9uIGJ1bmRsZScpXG4gICAgLm9wdGlvbignLS1idW5kbGUtY29tbWFuZCcsICd0aGUgY29tbWFuZCB0byBydW4gdG8gZ2VuZXJhdGUgdGhlIGJ1bmRsZSBkZWZhdWx0OiBza3lwYWdlciBleHBvcnQgYnVuZGxlJywgJ3NreXBhZ2VyIGV4cG9ydCBidW5kbGUnKVxuICAgIC5vcHRpb24oJy0tbWlkZGxld2FyZSA8cGF0aD4nLCAnYXBwbHkgZXhwcmVzcyBtaWRkbGV3YXJlIHRvIHRoZSBkZXYtc2VydmVyJylcbiAgICAuYWN0aW9uKGRpc3BhdGNoKGhhbmRsZSkpXG59XG5cbmV4cG9ydCBkZWZhdWx0IGRldmVsb3BcblxuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZSAoZW50cnksIG9wdGlvbnMgPSB7fSwgY29udGV4dCA9IHt9KSB7XG4gIGxhdW5jaFNlcnZlcihlbnRyeSwgb3B0aW9ucywgY29udGV4dClcblxuICBpZiAob3B0aW9ucy5idW5kbGUpIHtcbiAgICBjb25zb2xlLmxvZygnd2F0Y2hpbmcgYXNzZXRzIGZvciBjaGFuZ2VzJy5ncmVlbilcbiAgICBsYXVuY2hXYXRjaGVyKG9wdGlvbnMsIGNvbnRleHQpXG4gIH1cblxuICBpZiAob3B0aW9ucy5uZ3Jvaykge1xuICAgIGNvbnNvbGUubG9nKCdsYXVuY2hpbmcgbmdyb2sgdHVubmVsJy5ncmVlbilcbiAgICBsYXVuY2hUdW5uZWwob3B0aW9ucywgY29udGV4dClcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gbGF1bmNoV2F0Y2hlcihvcHRpb25zLCBjb250ZXh0KSB7XG4gIGxldCBwcm9qZWN0ID0gY29udGV4dC5wcm9qZWN0XG5cbiAgbGV0IGJ1bmRsZUNvbW1hbmQgPSBvcHRpb25zLmJ1bmRsZUNvbW1hbmQgfHwgJ3NreXBhZ2VyIGV4cG9ydCBidW5kbGUnXG5cbiAgdmFyIHByb2MgPSBzaGVsbC5leGVjKGBjaG9raWRhciAnLi97ZGF0YSxkb2NzfS8qKi8qLionIC0tc2lsZW50IC0tZGVib3VuY2UgMTIwMCAtYyAnJHsgYnVuZGxlQ29tbWFuZCB9J2AsIHthc3luYzogdHJ1ZX0pXG5cbiAgcHJvYy5zdGRvdXQub24oJ2RhdGEnLCAoZGF0YSkgPT4ge1xuICAgIGlmKCFvcHRpb25zLnNpbGVudCkge1xuICAgICAgY29uc29sZS5sb2coZGF0YSlcbiAgICB9XG4gIH0pXG5cbiAgcHJvYy5zdGRlcnIub24oJ2RhdGEnLCAoZGF0YSkgPT4ge1xuICAgIGlmKG9wdGlvbnMuZGVidWcpIHtcbiAgICAgIGNvbnNvbGUubG9nKGRhdGEpXG4gICAgfVxuICB9KVxufVxuXG5leHBvcnQgZnVuY3Rpb24gbGF1bmNoU2VydmVyIChlbnRyeSwgb3B0aW9ucyA9IHt9LCBjb250ZXh0ID0ge30pIHtcbiAgbGV0IHByb2plY3QgPSBjb250ZXh0LnByb2plY3RcblxuICBvcHRpb25zLmVudHJ5ID0gZW50cnkgfHwgb3B0aW9ucy5lbnRyeSB8fCBwcm9qZWN0Lm9wdGlvbnMuZW50cnkgfHwgJy4vc3JjJ1xuICBvcHRpb25zLnRoZW1lID0gb3B0aW9ucy50aGVtZSB8fCBwcm9qZWN0Lm9wdGlvbnMudGhlbWUgfHwgJ21hcmtldGluZydcblxuICBvcHRpb25zLnN0YXRpY0Fzc2V0cyA9IG9wdGlvbnMuc3RhdGljQXNzZXRzIHx8IHByb2plY3Qub3B0aW9ucy5zdGF0aWNBc3NldHMgfHwge31cblxuICByZXF1aXJlKGAkeyBwYXRoVG9EZXZwYWNrKG9wdGlvbnMuZGV2VG9vbHNQYXRoKSB9L3dlYnBhY2svc2VydmVyYCkob3B0aW9ucylcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGxhdW5jaFR1bm5lbChvcHRpb25zLCBjb250ZXh0KSB7XG4gIHZhciBzZXJ2ZXIgPSBzaGVsbC5leGVjKGBuZ3JvayBodHRwICR7IG9wdGlvbnMucG9ydCB8fCAzMDAwIH1gLCB7YXN5bmM6IHRydWV9KVxuXG4gIHNlcnZlci5zdGRvdXQub24oJ2RhdGEnLCAoZGF0YSkgPT4ge1xuICAgIGNvbnNvbGUubG9nKGRhdGEpXG4gIH0pXG5cbiAgc2VydmVyLnN0ZGVyci5vbignZGF0YScsIChkYXRhKSA9PiB7XG4gICAgY29uc29sZS5sb2coZGF0YSlcbiAgfSlcblxuICBzZXJ2ZXIub24oJ2VuZCcsICgpID0+IHtcbiAgICAgY29uc29sZS5sb2coJ05ncm9rIHR1bm5lbCBlbmRlZCcpXG4gIH0pXG59XG5cbmZ1bmN0aW9uIHBhdGhUb0RldnBhY2sgKG9wdCkgeyByZXR1cm4gKG9wdCAmJiByZXNvbHZlKG9wdCkpIHx8IHByb2Nlc3MuZW52LlNLWVBBR0VSX0RFVlBBQ0tfUEFUSCB8fCBkaXJuYW1lKCByZXF1aXJlLnJlc29sdmUoJ3NreXBhZ2VyLWRldnBhY2snKSkgfVxuXG5mdW5jdGlvbiBpc0RlcGFja0luc3RhbGxlZCAoKSB7XG4gIHRyeSB7XG4gICAgcmV0dXJuIHBhdGhUb0RldnBhY2soKVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiBmYWxzZVxuICB9XG59XG4iXX0=