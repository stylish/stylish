'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.build = build;
exports.handle = handle;

var _path = require('path');

var _shelljs = require('shelljs');

var _shelljs2 = _interopRequireDefault(_shelljs);

var _util = require('../util');

var _util2 = _interopRequireDefault(_util);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function build(program, dispatch) {
  program.command('build [entry]').description('build a website for this project using our preconfigured webpack bundle').option('--entry <path>', 'relative path to the entry point', './src').option('--entry-name <name>', 'what to name the entry point script', 'app').option('--platform <name>', 'which platform are we building for? electron or web', 'web').option('--external-vendors', "assume vendor libraries will be available to our script").option('--no-vendor-libraries', "don't include any vendor libraries in the bundle").option('--theme <name>', 'the name of the theme to use', 'dashboard').option('--output-folder <path>', 'relative path to the output folder', 'public').option('--html-filename <filename>', 'what should we name the html file?', 'index.html').option('--html-template-path <path>', 'path to the html template to use').option('--precompiled <name>', 'use a precompiled html template which includes vendor libs, themes, etc').option('--push-state', 'use a 200.html file to support push state').option('--content-hash', 'fingerprint the names of the files as a cache busting mechanism', true).option('--dev-tools-path <path>', 'path to the skypager-devpack').option('--webpack-config <path>', 'path to a javascript function which can mutate the webpack config').option('--export-library <name>', 'build this as a umd library').action(dispatch(handle));
}

exports.default = build;
function handle(entry) {
  var options = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];
  var context = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];

  entry = entry || options.entry;
  options.theme = options.theme || project.options.theme || 'marketing';

  process.env.NODE_ENV = 'production';
  require(pathToDevpack(options.devToolsPath) + '/webpack/compiler')(options);
}

function pathToDevpack(opt) {
  return opt && resolve(opt) || process.env.SKYPAGER_DEVPACK_PATH || (0, _path.dirname)(require.resolve('skypager-devpack'));
}

function isDepackInstalled() {
  try {
    return pathToDevpack();
  } catch (error) {
    return false;
  }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21tYW5kcy9idWlsZC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztRQUtnQixLQUFLLEdBQUwsS0FBSztRQXdCTCxNQUFNLEdBQU4sTUFBTTs7Ozs7Ozs7Ozs7Ozs7QUF4QmYsU0FBUyxLQUFLLENBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRTtBQUN4QyxTQUFPLENBQ0osT0FBTyxDQUFDLGVBQWUsQ0FBQyxDQUN4QixXQUFXLENBQUMseUVBQXlFLENBQUMsQ0FDdEYsTUFBTSxDQUFDLGdCQUFnQixFQUFFLGtDQUFrQyxFQUFFLE9BQU8sQ0FBQyxDQUNyRSxNQUFNLENBQUMscUJBQXFCLEVBQUUscUNBQXFDLEVBQUUsS0FBSyxDQUFDLENBQzNFLE1BQU0sQ0FBQyxtQkFBbUIsRUFBRSxxREFBcUQsRUFBRSxLQUFLLENBQUMsQ0FDekYsTUFBTSxDQUFDLG9CQUFvQixFQUFFLHlEQUF5RCxDQUFDLENBQ3ZGLE1BQU0sQ0FBQyx1QkFBdUIsRUFBRSxrREFBa0QsQ0FBQyxDQUNuRixNQUFNLENBQUMsZ0JBQWdCLEVBQUUsOEJBQThCLEVBQUUsV0FBVyxDQUFDLENBQ3JFLE1BQU0sQ0FBQyx3QkFBd0IsRUFBRSxvQ0FBb0MsRUFBRSxRQUFRLENBQUMsQ0FDaEYsTUFBTSxDQUFDLDRCQUE0QixFQUFFLG9DQUFvQyxFQUFFLFlBQVksQ0FBQyxDQUN4RixNQUFNLENBQUMsNkJBQTZCLEVBQUUsa0NBQWtDLENBQUMsQ0FDekUsTUFBTSxDQUFDLHNCQUFzQixFQUFFLHlFQUF5RSxDQUFDLENBQ3pHLE1BQU0sQ0FBQyxjQUFjLEVBQUUsMkNBQTJDLENBQUMsQ0FDbkUsTUFBTSxDQUFDLGdCQUFnQixFQUFFLGlFQUFpRSxFQUFFLElBQUksQ0FBQyxDQUNqRyxNQUFNLENBQUMseUJBQXlCLEVBQUUsOEJBQThCLENBQUMsQ0FDakUsTUFBTSxDQUFDLHlCQUF5QixFQUFFLG1FQUFtRSxDQUFDLENBQ3RHLE1BQU0sQ0FBQyx5QkFBeUIsRUFBRSw2QkFBNkIsQ0FBQyxDQUNoRSxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUE7Q0FDNUI7O2tCQUVjLEtBQUs7QUFFYixTQUFTLE1BQU0sQ0FBQyxLQUFLLEVBQThCO01BQTVCLE9BQU8seURBQUcsRUFBRTtNQUFFLE9BQU8seURBQUcsRUFBRTs7QUFDdEQsT0FBSyxHQUFHLEtBQUssSUFBSSxPQUFPLENBQUMsS0FBSyxDQUFBO0FBQzlCLFNBQU8sQ0FBQyxLQUFLLEdBQUcsT0FBTyxDQUFDLEtBQUssSUFBSSxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssSUFBSSxXQUFXLENBQUE7O0FBRXJFLFNBQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxHQUFHLFlBQVksQ0FBQTtBQUNuQyxTQUFPLENBQUssYUFBYSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsdUJBQXFCLENBQUMsT0FBTyxDQUFDLENBQUE7Q0FDOUU7O0FBR0QsU0FBUyxhQUFhLENBQUUsR0FBRyxFQUFFO0FBQUUsU0FBTyxBQUFDLEdBQUcsSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUssT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsSUFBSSxVQXRDckYsT0FBTyxFQXNDdUYsT0FBTyxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUE7Q0FBRTs7QUFFbkosU0FBUyxpQkFBaUIsR0FBSTtBQUM1QixNQUFJO0FBQ0YsV0FBTyxhQUFhLEVBQUUsQ0FBQTtHQUN2QixDQUFDLE9BQU8sS0FBSyxFQUFFO0FBQ2QsV0FBTyxLQUFLLENBQUE7R0FDYjtDQUNGIiwiZmlsZSI6ImJ1aWxkLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgam9pbiwgZGlybmFtZSB9IGZyb20gJ3BhdGgnXG5cbmltcG9ydCBzaGVsbCBmcm9tICdzaGVsbGpzJ1xuaW1wb3J0IHV0aWwgZnJvbSAnLi4vdXRpbCdcblxuZXhwb3J0IGZ1bmN0aW9uIGJ1aWxkIChwcm9ncmFtLCBkaXNwYXRjaCkge1xuICBwcm9ncmFtXG4gICAgLmNvbW1hbmQoJ2J1aWxkIFtlbnRyeV0nKVxuICAgIC5kZXNjcmlwdGlvbignYnVpbGQgYSB3ZWJzaXRlIGZvciB0aGlzIHByb2plY3QgdXNpbmcgb3VyIHByZWNvbmZpZ3VyZWQgd2VicGFjayBidW5kbGUnKVxuICAgIC5vcHRpb24oJy0tZW50cnkgPHBhdGg+JywgJ3JlbGF0aXZlIHBhdGggdG8gdGhlIGVudHJ5IHBvaW50JywgJy4vc3JjJylcbiAgICAub3B0aW9uKCctLWVudHJ5LW5hbWUgPG5hbWU+JywgJ3doYXQgdG8gbmFtZSB0aGUgZW50cnkgcG9pbnQgc2NyaXB0JywgJ2FwcCcpXG4gICAgLm9wdGlvbignLS1wbGF0Zm9ybSA8bmFtZT4nLCAnd2hpY2ggcGxhdGZvcm0gYXJlIHdlIGJ1aWxkaW5nIGZvcj8gZWxlY3Ryb24gb3Igd2ViJywgJ3dlYicpXG4gICAgLm9wdGlvbignLS1leHRlcm5hbC12ZW5kb3JzJywgXCJhc3N1bWUgdmVuZG9yIGxpYnJhcmllcyB3aWxsIGJlIGF2YWlsYWJsZSB0byBvdXIgc2NyaXB0XCIpXG4gICAgLm9wdGlvbignLS1uby12ZW5kb3ItbGlicmFyaWVzJywgXCJkb24ndCBpbmNsdWRlIGFueSB2ZW5kb3IgbGlicmFyaWVzIGluIHRoZSBidW5kbGVcIilcbiAgICAub3B0aW9uKCctLXRoZW1lIDxuYW1lPicsICd0aGUgbmFtZSBvZiB0aGUgdGhlbWUgdG8gdXNlJywgJ2Rhc2hib2FyZCcpXG4gICAgLm9wdGlvbignLS1vdXRwdXQtZm9sZGVyIDxwYXRoPicsICdyZWxhdGl2ZSBwYXRoIHRvIHRoZSBvdXRwdXQgZm9sZGVyJywgJ3B1YmxpYycpXG4gICAgLm9wdGlvbignLS1odG1sLWZpbGVuYW1lIDxmaWxlbmFtZT4nLCAnd2hhdCBzaG91bGQgd2UgbmFtZSB0aGUgaHRtbCBmaWxlPycsICdpbmRleC5odG1sJylcbiAgICAub3B0aW9uKCctLWh0bWwtdGVtcGxhdGUtcGF0aCA8cGF0aD4nLCAncGF0aCB0byB0aGUgaHRtbCB0ZW1wbGF0ZSB0byB1c2UnKVxuICAgIC5vcHRpb24oJy0tcHJlY29tcGlsZWQgPG5hbWU+JywgJ3VzZSBhIHByZWNvbXBpbGVkIGh0bWwgdGVtcGxhdGUgd2hpY2ggaW5jbHVkZXMgdmVuZG9yIGxpYnMsIHRoZW1lcywgZXRjJylcbiAgICAub3B0aW9uKCctLXB1c2gtc3RhdGUnLCAndXNlIGEgMjAwLmh0bWwgZmlsZSB0byBzdXBwb3J0IHB1c2ggc3RhdGUnKVxuICAgIC5vcHRpb24oJy0tY29udGVudC1oYXNoJywgJ2ZpbmdlcnByaW50IHRoZSBuYW1lcyBvZiB0aGUgZmlsZXMgYXMgYSBjYWNoZSBidXN0aW5nIG1lY2hhbmlzbScsIHRydWUpXG4gICAgLm9wdGlvbignLS1kZXYtdG9vbHMtcGF0aCA8cGF0aD4nLCAncGF0aCB0byB0aGUgc2t5cGFnZXItZGV2cGFjaycpXG4gICAgLm9wdGlvbignLS13ZWJwYWNrLWNvbmZpZyA8cGF0aD4nLCAncGF0aCB0byBhIGphdmFzY3JpcHQgZnVuY3Rpb24gd2hpY2ggY2FuIG11dGF0ZSB0aGUgd2VicGFjayBjb25maWcnKVxuICAgIC5vcHRpb24oJy0tZXhwb3J0LWxpYnJhcnkgPG5hbWU+JywgJ2J1aWxkIHRoaXMgYXMgYSB1bWQgbGlicmFyeScpXG4gICAgLmFjdGlvbihkaXNwYXRjaChoYW5kbGUpKVxufVxuXG5leHBvcnQgZGVmYXVsdCBidWlsZFxuXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlKGVudHJ5LCBvcHRpb25zID0ge30sIGNvbnRleHQgPSB7fSkge1xuICBlbnRyeSA9IGVudHJ5IHx8IG9wdGlvbnMuZW50cnlcbiAgb3B0aW9ucy50aGVtZSA9IG9wdGlvbnMudGhlbWUgfHwgcHJvamVjdC5vcHRpb25zLnRoZW1lIHx8ICdtYXJrZXRpbmcnXG5cbiAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPSAncHJvZHVjdGlvbidcbiAgcmVxdWlyZShgJHsgcGF0aFRvRGV2cGFjayhvcHRpb25zLmRldlRvb2xzUGF0aCkgfS93ZWJwYWNrL2NvbXBpbGVyYCkob3B0aW9ucylcbn1cblxuXG5mdW5jdGlvbiBwYXRoVG9EZXZwYWNrIChvcHQpIHsgcmV0dXJuIChvcHQgJiYgcmVzb2x2ZShvcHQpKSB8fCBwcm9jZXNzLmVudi5TS1lQQUdFUl9ERVZQQUNLX1BBVEggfHwgZGlybmFtZSggcmVxdWlyZS5yZXNvbHZlKCdza3lwYWdlci1kZXZwYWNrJykpIH1cblxuZnVuY3Rpb24gaXNEZXBhY2tJbnN0YWxsZWQgKCkge1xuICB0cnkge1xuICAgIHJldHVybiBwYXRoVG9EZXZwYWNrKClcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxufVxuIl19