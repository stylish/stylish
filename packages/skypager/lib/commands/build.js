'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.build = build;
exports.handle = handle;

var _path = require('path');

var _shelljs = require('shelljs');

var _shelljs2 = _interopRequireDefault(_shelljs);

var _util = require('../util');

var _util2 = _interopRequireDefault(_util);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function build(program, dispatch) {
  program.command('build [entry]').description('build a website for this project using our preconfigured webpack bundle').option('--entry <path>', 'relative path to the entry point', './src').option('--entry-name <name>', 'what to name the entry point script', 'app').option('--entry-only', 'only compiled asssets; do not use html template').option('--platform <name>', 'which platform are we building for? electron or web', 'web').option('--external-vendors', "assume vendor libraries will be available to our script").option('--no-vendor-libraries', "don't include any vendor libraries in the bundle").option('--theme <name>', 'the name of the theme to use', 'dashboard').option('--output-folder <path>', 'relative path to the output folder', 'public').option('--html-filename <filename>', 'what should we name the html file?', 'index.html').option('--html-template-path <path>', 'path to the html template to use').option('--precompiled <name>', 'use a precompiled html template which includes vendor libs, themes, etc').option('--push-state', 'use a 200.html file to support push state').option('--content-hash', 'fingerprint the names of the files as a cache busting mechanism', true).option('--no-content-hash', 'fingerprint the names of the files as a cache busting mechanism', true).option('--dev-tools-path <path>', 'path to the skypager-devpack').option('--webpack-config <path>', 'path to a javascript function which can mutate the webpack config').option('--export-library <name>', 'build this as a umd library').option('--modules-path <path>', 'which modules folder to use for webpacks default? defaults to standard node_modules').option('--dist-path <path>', 'the project exporter or dist path').option('--skip-theme', 'do not include any skypager-theme content').option('--feature-flags <path>', 'path to a script which exports an object to be used for feature flags').option('--bundle', 'watch for content changes in the project and update the distribution bundle').option('--bundle-command', 'the command to run to generate the bundle default: skypager export bundle', 'skypager export bundle').option('--silent', 'suppress any server output').option('--debug', 'show error info from the server').option('--template-inject [target]', 'where to inject the webpack bundle? none, body, head').option('--exclude-chunks [list]', 'chunk names to exclude from the html bundle').option('--chunks [list]', 'chunk names to exclude from the html bundle').action(dispatch(handle));
}

exports.default = build;
function handle(entry) {
  var options = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];
  var context = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];

  entry = entry || options.entry;
  options.theme = options.theme || project.options.theme;

  if (!options.theme && !options.skipTheme) {
    console.log('Are you sure you want to run without a theme?'.yellow);
  }

  process.env.NODE_ENV = 'production';

  var bundleCommand = options.bundleCommand || 'skypager export bundle';

  console.log('Exporting project bundle'.green);
  _shelljs2.default.exec(bundleCommand + ' --clean');

  require(pathToDevpack(options.devToolsPath) + '/webpack/compiler')(options);
}

function pathToDevpack(opt) {
  return opt && resolve(opt) || process.env.SKYPAGER_DEVPACK_PATH || (0, _path.dirname)(require.resolve('skypager-devpack'));
}

function isDepackInstalled() {
  try {
    return pathToDevpack();
  } catch (error) {
    return false;
  }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21tYW5kcy9idWlsZC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztRQUtnQixLQUFLLEdBQUwsS0FBSztRQXFDTCxNQUFNLEdBQU4sTUFBTTs7Ozs7Ozs7Ozs7Ozs7QUFyQ2YsU0FBUyxLQUFLLENBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRTtBQUN4QyxTQUFPLENBQ0osT0FBTyxDQUFDLGVBQWUsQ0FBQyxDQUN4QixXQUFXLENBQUMseUVBQXlFLENBQUMsQ0FDdEYsTUFBTSxDQUFDLGdCQUFnQixFQUFFLGtDQUFrQyxFQUFFLE9BQU8sQ0FBQyxDQUNyRSxNQUFNLENBQUMscUJBQXFCLEVBQUUscUNBQXFDLEVBQUUsS0FBSyxDQUFDLENBQzNFLE1BQU0sQ0FBQyxjQUFjLEVBQUUsaURBQWlELENBQUMsQ0FDekUsTUFBTSxDQUFDLG1CQUFtQixFQUFFLHFEQUFxRCxFQUFFLEtBQUssQ0FBQyxDQUN6RixNQUFNLENBQUMsb0JBQW9CLEVBQUUseURBQXlELENBQUMsQ0FDdkYsTUFBTSxDQUFDLHVCQUF1QixFQUFFLGtEQUFrRCxDQUFDLENBQ25GLE1BQU0sQ0FBQyxnQkFBZ0IsRUFBRSw4QkFBOEIsRUFBRSxXQUFXLENBQUMsQ0FDckUsTUFBTSxDQUFDLHdCQUF3QixFQUFFLG9DQUFvQyxFQUFFLFFBQVEsQ0FBQyxDQUNoRixNQUFNLENBQUMsNEJBQTRCLEVBQUUsb0NBQW9DLEVBQUUsWUFBWSxDQUFDLENBQ3hGLE1BQU0sQ0FBQyw2QkFBNkIsRUFBRSxrQ0FBa0MsQ0FBQyxDQUN6RSxNQUFNLENBQUMsc0JBQXNCLEVBQUUseUVBQXlFLENBQUMsQ0FDekcsTUFBTSxDQUFDLGNBQWMsRUFBRSwyQ0FBMkMsQ0FBQyxDQUNuRSxNQUFNLENBQUMsZ0JBQWdCLEVBQUUsaUVBQWlFLEVBQUUsSUFBSSxDQUFDLENBQ2pHLE1BQU0sQ0FBQyxtQkFBbUIsRUFBRSxpRUFBaUUsRUFBRSxJQUFJLENBQUMsQ0FDcEcsTUFBTSxDQUFDLHlCQUF5QixFQUFFLDhCQUE4QixDQUFDLENBQ2pFLE1BQU0sQ0FBQyx5QkFBeUIsRUFBRSxtRUFBbUUsQ0FBQyxDQUN0RyxNQUFNLENBQUMseUJBQXlCLEVBQUUsNkJBQTZCLENBQUMsQ0FDaEUsTUFBTSxDQUFDLHVCQUF1QixFQUFFLHFGQUFxRixDQUFDLENBQ3RILE1BQU0sQ0FBQyxvQkFBb0IsRUFBRSxtQ0FBbUMsQ0FBQyxDQUNqRSxNQUFNLENBQUMsY0FBYyxFQUFFLDJDQUEyQyxDQUFDLENBQ25FLE1BQU0sQ0FBQyx3QkFBd0IsRUFBRSx1RUFBdUUsQ0FBQyxDQUN6RyxNQUFNLENBQUMsVUFBVSxFQUFFLDZFQUE2RSxDQUFDLENBQ2pHLE1BQU0sQ0FBQyxrQkFBa0IsRUFBRSwyRUFBMkUsRUFBRSx3QkFBd0IsQ0FBQyxDQUNqSSxNQUFNLENBQUMsVUFBVSxFQUFFLDRCQUE0QixDQUFDLENBQ2hELE1BQU0sQ0FBQyxTQUFTLEVBQUUsaUNBQWlDLENBQUMsQ0FDcEQsTUFBTSxDQUFDLDRCQUE0QixFQUFFLHNEQUFzRCxDQUFDLENBQzVGLE1BQU0sQ0FBQyx5QkFBeUIsRUFBRSw2Q0FBNkMsQ0FBQyxDQUNoRixNQUFNLENBQUMsaUJBQWlCLEVBQUUsNkNBQTZDLENBQUMsQ0FDeEUsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFBO0NBQzVCOztrQkFFYyxLQUFLO0FBRWIsU0FBUyxNQUFNLENBQUMsS0FBSyxFQUE4QjtNQUE1QixPQUFPLHlEQUFHLEVBQUU7TUFBRSxPQUFPLHlEQUFHLEVBQUU7O0FBQ3RELE9BQUssR0FBRyxLQUFLLElBQUksT0FBTyxDQUFDLEtBQUssQ0FBQTtBQUM5QixTQUFPLENBQUMsS0FBSyxHQUFHLE9BQU8sQ0FBQyxLQUFLLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUE7O0FBRXRELE1BQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRTtBQUN4QyxXQUFPLENBQUMsR0FBRyxDQUFDLCtDQUErQyxDQUFDLE1BQU0sQ0FBQyxDQUFBO0dBQ3BFOztBQUVELFNBQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxHQUFHLFlBQVksQ0FBQTs7QUFFbkMsTUFBSSxhQUFhLEdBQUcsT0FBTyxDQUFDLGFBQWEsSUFBSSx3QkFBd0IsQ0FBQTs7QUFFckUsU0FBTyxDQUFDLEdBQUcsQ0FBQywwQkFBMEIsQ0FBQyxLQUFLLENBQUMsQ0FBQTtBQUM3QyxvQkFBTSxJQUFJLENBQUssYUFBYSxjQUFZLENBQUE7O0FBRXhDLFNBQU8sQ0FBSyxhQUFhLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyx1QkFBcUIsQ0FBQyxPQUFPLENBQUMsQ0FBQTtDQUM5RTs7QUFHRCxTQUFTLGFBQWEsQ0FBRSxHQUFHLEVBQUU7QUFBRSxTQUFPLEFBQUMsR0FBRyxJQUFJLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSyxPQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFxQixJQUFJLFVBN0RyRixPQUFPLEVBNkR1RixPQUFPLENBQUMsT0FBTyxDQUFDLGtCQUFrQixDQUFDLENBQUMsQ0FBQTtDQUFFOztBQUVuSixTQUFTLGlCQUFpQixHQUFJO0FBQzVCLE1BQUk7QUFDRixXQUFPLGFBQWEsRUFBRSxDQUFBO0dBQ3ZCLENBQUMsT0FBTyxLQUFLLEVBQUU7QUFDZCxXQUFPLEtBQUssQ0FBQTtHQUNiO0NBQ0YiLCJmaWxlIjoiYnVpbGQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBqb2luLCBkaXJuYW1lIH0gZnJvbSAncGF0aCdcblxuaW1wb3J0IHNoZWxsIGZyb20gJ3NoZWxsanMnXG5pbXBvcnQgdXRpbCBmcm9tICcuLi91dGlsJ1xuXG5leHBvcnQgZnVuY3Rpb24gYnVpbGQgKHByb2dyYW0sIGRpc3BhdGNoKSB7XG4gIHByb2dyYW1cbiAgICAuY29tbWFuZCgnYnVpbGQgW2VudHJ5XScpXG4gICAgLmRlc2NyaXB0aW9uKCdidWlsZCBhIHdlYnNpdGUgZm9yIHRoaXMgcHJvamVjdCB1c2luZyBvdXIgcHJlY29uZmlndXJlZCB3ZWJwYWNrIGJ1bmRsZScpXG4gICAgLm9wdGlvbignLS1lbnRyeSA8cGF0aD4nLCAncmVsYXRpdmUgcGF0aCB0byB0aGUgZW50cnkgcG9pbnQnLCAnLi9zcmMnKVxuICAgIC5vcHRpb24oJy0tZW50cnktbmFtZSA8bmFtZT4nLCAnd2hhdCB0byBuYW1lIHRoZSBlbnRyeSBwb2ludCBzY3JpcHQnLCAnYXBwJylcbiAgICAub3B0aW9uKCctLWVudHJ5LW9ubHknLCAnb25seSBjb21waWxlZCBhc3NzZXRzOyBkbyBub3QgdXNlIGh0bWwgdGVtcGxhdGUnKVxuICAgIC5vcHRpb24oJy0tcGxhdGZvcm0gPG5hbWU+JywgJ3doaWNoIHBsYXRmb3JtIGFyZSB3ZSBidWlsZGluZyBmb3I/IGVsZWN0cm9uIG9yIHdlYicsICd3ZWInKVxuICAgIC5vcHRpb24oJy0tZXh0ZXJuYWwtdmVuZG9ycycsIFwiYXNzdW1lIHZlbmRvciBsaWJyYXJpZXMgd2lsbCBiZSBhdmFpbGFibGUgdG8gb3VyIHNjcmlwdFwiKVxuICAgIC5vcHRpb24oJy0tbm8tdmVuZG9yLWxpYnJhcmllcycsIFwiZG9uJ3QgaW5jbHVkZSBhbnkgdmVuZG9yIGxpYnJhcmllcyBpbiB0aGUgYnVuZGxlXCIpXG4gICAgLm9wdGlvbignLS10aGVtZSA8bmFtZT4nLCAndGhlIG5hbWUgb2YgdGhlIHRoZW1lIHRvIHVzZScsICdkYXNoYm9hcmQnKVxuICAgIC5vcHRpb24oJy0tb3V0cHV0LWZvbGRlciA8cGF0aD4nLCAncmVsYXRpdmUgcGF0aCB0byB0aGUgb3V0cHV0IGZvbGRlcicsICdwdWJsaWMnKVxuICAgIC5vcHRpb24oJy0taHRtbC1maWxlbmFtZSA8ZmlsZW5hbWU+JywgJ3doYXQgc2hvdWxkIHdlIG5hbWUgdGhlIGh0bWwgZmlsZT8nLCAnaW5kZXguaHRtbCcpXG4gICAgLm9wdGlvbignLS1odG1sLXRlbXBsYXRlLXBhdGggPHBhdGg+JywgJ3BhdGggdG8gdGhlIGh0bWwgdGVtcGxhdGUgdG8gdXNlJylcbiAgICAub3B0aW9uKCctLXByZWNvbXBpbGVkIDxuYW1lPicsICd1c2UgYSBwcmVjb21waWxlZCBodG1sIHRlbXBsYXRlIHdoaWNoIGluY2x1ZGVzIHZlbmRvciBsaWJzLCB0aGVtZXMsIGV0YycpXG4gICAgLm9wdGlvbignLS1wdXNoLXN0YXRlJywgJ3VzZSBhIDIwMC5odG1sIGZpbGUgdG8gc3VwcG9ydCBwdXNoIHN0YXRlJylcbiAgICAub3B0aW9uKCctLWNvbnRlbnQtaGFzaCcsICdmaW5nZXJwcmludCB0aGUgbmFtZXMgb2YgdGhlIGZpbGVzIGFzIGEgY2FjaGUgYnVzdGluZyBtZWNoYW5pc20nLCB0cnVlKVxuICAgIC5vcHRpb24oJy0tbm8tY29udGVudC1oYXNoJywgJ2ZpbmdlcnByaW50IHRoZSBuYW1lcyBvZiB0aGUgZmlsZXMgYXMgYSBjYWNoZSBidXN0aW5nIG1lY2hhbmlzbScsIHRydWUpXG4gICAgLm9wdGlvbignLS1kZXYtdG9vbHMtcGF0aCA8cGF0aD4nLCAncGF0aCB0byB0aGUgc2t5cGFnZXItZGV2cGFjaycpXG4gICAgLm9wdGlvbignLS13ZWJwYWNrLWNvbmZpZyA8cGF0aD4nLCAncGF0aCB0byBhIGphdmFzY3JpcHQgZnVuY3Rpb24gd2hpY2ggY2FuIG11dGF0ZSB0aGUgd2VicGFjayBjb25maWcnKVxuICAgIC5vcHRpb24oJy0tZXhwb3J0LWxpYnJhcnkgPG5hbWU+JywgJ2J1aWxkIHRoaXMgYXMgYSB1bWQgbGlicmFyeScpXG4gICAgLm9wdGlvbignLS1tb2R1bGVzLXBhdGggPHBhdGg+JywgJ3doaWNoIG1vZHVsZXMgZm9sZGVyIHRvIHVzZSBmb3Igd2VicGFja3MgZGVmYXVsdD8gZGVmYXVsdHMgdG8gc3RhbmRhcmQgbm9kZV9tb2R1bGVzJylcbiAgICAub3B0aW9uKCctLWRpc3QtcGF0aCA8cGF0aD4nLCAndGhlIHByb2plY3QgZXhwb3J0ZXIgb3IgZGlzdCBwYXRoJylcbiAgICAub3B0aW9uKCctLXNraXAtdGhlbWUnLCAnZG8gbm90IGluY2x1ZGUgYW55IHNreXBhZ2VyLXRoZW1lIGNvbnRlbnQnKVxuICAgIC5vcHRpb24oJy0tZmVhdHVyZS1mbGFncyA8cGF0aD4nLCAncGF0aCB0byBhIHNjcmlwdCB3aGljaCBleHBvcnRzIGFuIG9iamVjdCB0byBiZSB1c2VkIGZvciBmZWF0dXJlIGZsYWdzJylcbiAgICAub3B0aW9uKCctLWJ1bmRsZScsICd3YXRjaCBmb3IgY29udGVudCBjaGFuZ2VzIGluIHRoZSBwcm9qZWN0IGFuZCB1cGRhdGUgdGhlIGRpc3RyaWJ1dGlvbiBidW5kbGUnKVxuICAgIC5vcHRpb24oJy0tYnVuZGxlLWNvbW1hbmQnLCAndGhlIGNvbW1hbmQgdG8gcnVuIHRvIGdlbmVyYXRlIHRoZSBidW5kbGUgZGVmYXVsdDogc2t5cGFnZXIgZXhwb3J0IGJ1bmRsZScsICdza3lwYWdlciBleHBvcnQgYnVuZGxlJylcbiAgICAub3B0aW9uKCctLXNpbGVudCcsICdzdXBwcmVzcyBhbnkgc2VydmVyIG91dHB1dCcpXG4gICAgLm9wdGlvbignLS1kZWJ1ZycsICdzaG93IGVycm9yIGluZm8gZnJvbSB0aGUgc2VydmVyJylcbiAgICAub3B0aW9uKCctLXRlbXBsYXRlLWluamVjdCBbdGFyZ2V0XScsICd3aGVyZSB0byBpbmplY3QgdGhlIHdlYnBhY2sgYnVuZGxlPyBub25lLCBib2R5LCBoZWFkJylcbiAgICAub3B0aW9uKCctLWV4Y2x1ZGUtY2h1bmtzIFtsaXN0XScsICdjaHVuayBuYW1lcyB0byBleGNsdWRlIGZyb20gdGhlIGh0bWwgYnVuZGxlJylcbiAgICAub3B0aW9uKCctLWNodW5rcyBbbGlzdF0nLCAnY2h1bmsgbmFtZXMgdG8gZXhjbHVkZSBmcm9tIHRoZSBodG1sIGJ1bmRsZScpXG4gICAgLmFjdGlvbihkaXNwYXRjaChoYW5kbGUpKVxufVxuXG5leHBvcnQgZGVmYXVsdCBidWlsZFxuXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlKGVudHJ5LCBvcHRpb25zID0ge30sIGNvbnRleHQgPSB7fSkge1xuICBlbnRyeSA9IGVudHJ5IHx8IG9wdGlvbnMuZW50cnlcbiAgb3B0aW9ucy50aGVtZSA9IG9wdGlvbnMudGhlbWUgfHwgcHJvamVjdC5vcHRpb25zLnRoZW1lXG5cbiAgaWYgKCFvcHRpb25zLnRoZW1lICYmICFvcHRpb25zLnNraXBUaGVtZSkge1xuICAgIGNvbnNvbGUubG9nKCdBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gcnVuIHdpdGhvdXQgYSB0aGVtZT8nLnllbGxvdylcbiAgfVxuXG4gIHByb2Nlc3MuZW52Lk5PREVfRU5WID0gJ3Byb2R1Y3Rpb24nXG5cbiAgbGV0IGJ1bmRsZUNvbW1hbmQgPSBvcHRpb25zLmJ1bmRsZUNvbW1hbmQgfHwgJ3NreXBhZ2VyIGV4cG9ydCBidW5kbGUnXG5cbiAgY29uc29sZS5sb2coJ0V4cG9ydGluZyBwcm9qZWN0IGJ1bmRsZScuZ3JlZW4pXG4gIHNoZWxsLmV4ZWMoYCR7IGJ1bmRsZUNvbW1hbmQgfSAtLWNsZWFuYClcblxuICByZXF1aXJlKGAkeyBwYXRoVG9EZXZwYWNrKG9wdGlvbnMuZGV2VG9vbHNQYXRoKSB9L3dlYnBhY2svY29tcGlsZXJgKShvcHRpb25zKVxufVxuXG5cbmZ1bmN0aW9uIHBhdGhUb0RldnBhY2sgKG9wdCkgeyByZXR1cm4gKG9wdCAmJiByZXNvbHZlKG9wdCkpIHx8IHByb2Nlc3MuZW52LlNLWVBBR0VSX0RFVlBBQ0tfUEFUSCB8fCBkaXJuYW1lKCByZXF1aXJlLnJlc29sdmUoJ3NreXBhZ2VyLWRldnBhY2snKSkgfVxuXG5mdW5jdGlvbiBpc0RlcGFja0luc3RhbGxlZCAoKSB7XG4gIHRyeSB7XG4gICAgcmV0dXJuIHBhdGhUb0RldnBhY2soKVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiBmYWxzZVxuICB9XG59XG4iXX0=