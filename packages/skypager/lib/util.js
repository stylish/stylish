'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.clone = clone;
exports.humanize = humanize;
exports.titleize = titleize;
exports.classify = classify;
exports.tableize = tableize;
exports.tabelize = tabelize;
exports.underscore = underscore;
exports.parameterize = parameterize;
exports.slugify = slugify;
exports.singularize = singularize;
exports.pluralize = pluralize;
exports.lazy = lazy;
exports.lazyAsync = lazyAsync;
exports.flatten = flatten;
exports.singularize = singularize;
exports.createDelegators = createDelegators;
exports.values = values;
exports.mixin = mixin;
exports.access = access;
exports.copyProp = copyProp;
exports.noConflict = noConflict;
exports.carve = carve;
exports.loadManifestFromDirectory = loadManifestFromDirectory;
exports.isDomain = isDomain;
exports.loadProjectFromDirectory = loadProjectFromDirectory;
exports.isArray = isArray;
exports.isRegex = isRegex;
exports.filterQuery = filterQuery;
exports.abort = abort;

var _unistUtilVisit = require('unist-util-visit');

var _unistUtilVisit2 = _interopRequireDefault(_unistUtilVisit);

var _objectAssign = require('object-assign');

var _objectAssign2 = _interopRequireDefault(_objectAssign);

var _objectPath = require('object-path');

var _objectPath2 = _interopRequireDefault(_objectPath);

var _utile = require('utile');

var _utile2 = _interopRequireDefault(_utile);

var _debug2 = require('debug');

var _debug3 = _interopRequireDefault(_debug2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _typeof(obj) { return obj && typeof Symbol !== "undefined" && obj.constructor === Symbol ? "symbol" : typeof obj; }

var inflections = _utile2.default.inflect;
var debug = (0, _debug3.default)('skypager');
var DOMAIN_REGEX = /^[a-zA-Z0-9_-]+\.[.a-zA-Z0-9_-]+$/;

module.exports.visit = _unistUtilVisit2.default;
module.exports.assign = _objectAssign2.default;

var hidden = {
  getter: function getter(target, name, fn) {
    var configurable = arguments.length <= 3 || arguments[3] === undefined ? false : arguments[3];

    Object.defineProperty(target, name, {
      configurable: configurable,
      enumerable: false,
      get: function get() {
        return typeof fn === 'function' ? fn.call(target) : fn;
      }
    });
  },

  property: function property(target, name, value) {
    var configurable = arguments.length <= 3 || arguments[3] === undefined ? false : arguments[3];

    Object.defineProperty(target, name, {
      configurable: configurable,
      enumerable: false,
      value: value
    });
  }
};

module.exports.hidden = hidden;
module.exports.hide = hidden;

hidden.getter(module.exports, 'inflections', inflections);

/**
* clone an object
*
*/
function clone(base) {
  return JSON.parse(JSON.stringify(base));
}

function humanize(s) {
  return inflections.humanize(s).replace(/-|_/g, ' ');
}

function titleize(s) {
  return inflections.titleize(humanize(s));
}

function classify(s) {
  return inflections.classify(s);
}

function tableize(s) {
  return inflections.tableize(s);
}

function tabelize(s) {
  return inflections.tableize(s);
}

function underscore(s) {
  s = s.replace(/\\|\//g, '-', '');
  s = s.replace(/[^-\w\s]/g, ''); // remove unneeded chars
  s = s.replace(/^\s+|\s+$/g, ''); // trim leading/trailing spaces
  s = s.replace('-', '_');
  s = s.replace(/[-\s]+/g, '_'); // convert spaces to hyphens
  s = s.toLowerCase(); // convert to lowercase
  return s;
}

function parameterize(s) {
  s = s.replace(/\\|\//g, '-', '');
  s = s.replace(/[^-\w\s]/g, ''); // remove unneeded chars
  s = s.replace(/^\s+|\s+$/g, ''); // trim leading/trailing spaces
  s = s.replace(/[-\s]+/g, '-'); // convert spaces to hyphens
  s = s.toLowerCase(); // convert to lowercase
  return s;
}

function slugify(s) {
  s = s.replace(/\\|\//g, '-', '');
  s = s.replace(/[^-\w\s]/g, ''); // remove unneeded chars
  s = s.replace(/^\s+|\s+$/g, ''); // trim leading/trailing spaces
  s = s.replace(/[-\s]+/g, '-'); // convert spaces to hyphens
  s = s.toLowerCase(); // convert to lowercase
  return s;
}

function singularize(word) {
  return inflections.singularize(word);
}

function pluralize(word) {
  return inflections.pluralize(word);
}

function lazy(target, attribute, fn) {
  var enumerable = arguments.length <= 3 || arguments[3] === undefined ? true : arguments[3];

  Object.defineProperty(target, attribute, {
    configurable: true,
    enumerable: enumerable,
    get: function get() {
      delete target[attribute];

      if (enumerable) {
        return target[attribute] = fn.call(target);
      } else {
        var _ret = (function () {
          var value = fn.call(target);

          Object.defineProperty(target, attribute, {
            enumerable: false,
            configurable: false,
            get: function get() {
              return value;
            }
          });

          return {
            v: value
          };
        })();

        if ((typeof _ret === 'undefined' ? 'undefined' : _typeof(_ret)) === "object") return _ret.v;
      }
    }
  });
}

function lazyAsync(target, attribute, fn) {
  Object.defineProperty(target, attribute, {
    configurable: true,
    get: function get() {
      delete target[attribute];

      var result = undefined;

      async(function () {
        result = fn();
      })();

      return target[attribute] = result;
    }
  });
}

function flatten(array) {
  return array.reduce(function (a, b) {
    return a.concat(b);
  }, []);
}

function singularize(string) {
  return inflections.singularize(string);
}

function createDelegators(target, source) {
  var options = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];

  var excludeKeys = options.exclude || options.except || [];
  var sourceKeys = Object.keys(source).filter(function (key) {
    return excludeKeys.indexOf(key) === -1;
  });

  sourceKeys.forEach(function (key) {
    return Object.defineProperty(target, key, {
      get: function get() {
        return source[key];
      }
    });
  });
}

function values(object) {
  return Object.keys(object).map(function (key) {
    return object[key];
  });
}

function mixin(target, source) {
  target = target.prototype;source = source.prototype;

  Object.getOwnPropertyNames(source).forEach(function (name) {
    if (name !== 'constructor') Object.defineProperty(target, name, Object.getOwnPropertyDescriptor(source, name));
  });
}

function access(object, dotted) {
  return dotted.split('.').reduce(function (memo, current) {
    return memo[current];
  }, object);
}

function copyProp(property) {
  return {
    from: function from(source) {
      return {
        to: function to(target) {
          var desc = Object.getOwnPropertyDescriptor(source, property);

          if (typeof desc !== 'undefined' && desc.configurable) {
            Object.defineProperty(target, property, desc);
          }
        }
      };
    }
  };
}

function noConflict(fn) {
  var provider = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];
  var scope = arguments[2];

  fn.should.be.a.Function;
  provider.should.be.an.Object;

  var safe = {};

  return function () {
    Object.keys(provider).forEach(function (globalProp) {
      if (global.hasOwnProperty(globalProp)) {
        var descriptor = Object.getOwnPropertyDescriptor(global, globalProp);

        if (descriptor && descriptor.configurable) {
          Object.defineProperty(safe, globalProp, descriptor);
        }
      }

      Object.defineProperty(global, globalProp, Object.getOwnPropertyDescriptor(provider, globalProp));
    });

    var result = undefined;

    try {
      result = scope ? fn.call(scope) : fn();
    } catch (e) {
      result = 'error';
      console.log(e.message);
      console.error('Error in no conflict fn', e.message, e.stack);
    }

    Object.keys(provider).forEach(function (remove) {
      return delete global[remove];
    });

    Object.keys(safe).forEach(function (restore) {
      delete global[restore];
      Object.defineProperty(global, restore, Object.getOwnPropertyDescriptor(safe, restore));
    });

    return result;
  };
}

function carve(dataPath, resultValue) {
  var initialValue = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];

  _objectPath2.default.set(initialValue, dataPath, resultValue);
  return initialValue;
}

function loadManifestFromDirectory(directory) {
  var path = require('path');
  var manifest = require(path.join(directory, 'package.json')) || {};
  return manifest;
}

function isDomain(value) {
  return value.match(DOMAIN_REGEX);
}

function loadProjectFromDirectory(directory) {
  var exists = require('fs').existsSync;
  var path = require('path');

  var manifest = loadManifestFromDirectory(directory);

  if (manifest.skypager && manifest.skypager.main) {
    return require(path.join(directory, manifest.skypager.main.replace(/^\.\//, '')));
  }

  if (exists(path.join(directory, 'skypager.js'))) {
    return require(path.join(directory, 'skypager.js'));
  }

  if (exists(path.join(directory, 'index.js'))) {
    var p = require(path.join(directory, 'index.js'));

    if (!p.registries && !p.docs) {
      abort('This project does not seem to have a skypager project');
    }

    return p;
  }
}

function isArray(arg) {
  return Object.prototype.toString.call(arg) === '[object Array]';
}

function isRegex(val) {
  if ((typeof val === 'undefined' ? 'undefined' : typeof val === 'undefined' ? 'undefined' : _typeof(val)) === 'object' && Object.getPrototypeOf(val).toString() === '/(?:)/') {
    return true;
  }

  return false;
}

function filterQuery() {
  var nodeList = arguments.length <= 0 || arguments[0] === undefined ? [] : arguments[0];
  var params = arguments[1];

  if (typeof params === 'function') {
    return nodeList.filter(params);
  }

  return (nodeList || []).filter(function (node) {
    return Object.keys(params).every(function (key) {
      var param = params[key];
      var value = node[key];

      if (isRegex(param) && param.test(value)) {
        return true;
      }

      if (typeof param === 'string' && value === param) {
        return true;
      }

      if (typeof param === 'number' && value === param) {
        return true;
      }

      // treat normal arrays to search for any exact matches
      if (isArray(param)) {
        return param.any(function (val) {
          return val === value;
        });
      }
    });
  });
}

function abort(message) {
  console.log(message.red || message);
  process.exit(1);
}
//# sourceMappingURL=data:application/json;base64,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QUFDLENBQUMsQ0FBQTtDQUNqQiIsImZpbGUiOiJ1dGlsLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHZpc2l0IGZyb20gJ3VuaXN0LXV0aWwtdmlzaXQnXG5pbXBvcnQgYXNzaWduIGZyb20gJ29iamVjdC1hc3NpZ24nXG5pbXBvcnQgZG90cGF0aCBmcm9tICdvYmplY3QtcGF0aCdcbmltcG9ydCB1dGlsZSBmcm9tICd1dGlsZSdcbmltcG9ydCBfZGVidWcgZnJvbSAnZGVidWcnXG5cbmNvbnN0IGluZmxlY3Rpb25zID0gdXRpbGUuaW5mbGVjdFxuY29uc3QgZGVidWcgPSBfZGVidWcoJ3NreXBhZ2VyJylcbmNvbnN0IERPTUFJTl9SRUdFWCA9IC9eW2EtekEtWjAtOV8tXStcXC5bLmEtekEtWjAtOV8tXSskL1xuXG5tb2R1bGUuZXhwb3J0cy52aXNpdCA9IHZpc2l0XG5tb2R1bGUuZXhwb3J0cy5hc3NpZ24gPSBhc3NpZ25cblxubGV0IGhpZGRlbiA9IHtcbiAgZ2V0dGVyOiBmdW5jdGlvbiAodGFyZ2V0LCBuYW1lLCBmbiwgY29uZmlndXJhYmxlID0gZmFsc2UpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBuYW1lLCB7XG4gICAgICBjb25maWd1cmFibGU6IGNvbmZpZ3VyYWJsZSxcbiAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAodHlwZW9mIChmbikgPT09ICdmdW5jdGlvbicpID8gZm4uY2FsbCh0YXJnZXQpIDogZm5cbiAgICAgIH1cbiAgICB9KVxuICB9LFxuXG4gIHByb3BlcnR5OiBmdW5jdGlvbiAodGFyZ2V0LCBuYW1lLCB2YWx1ZSwgY29uZmlndXJhYmxlID0gZmFsc2UpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBuYW1lLCB7XG4gICAgICBjb25maWd1cmFibGU6IGNvbmZpZ3VyYWJsZSxcbiAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgdmFsdWU6IHZhbHVlXG4gICAgfSlcbiAgfVxufVxuXG5cbm1vZHVsZS5leHBvcnRzLmhpZGRlbiA9IGhpZGRlblxubW9kdWxlLmV4cG9ydHMuaGlkZSA9IGhpZGRlblxuXG5oaWRkZW4uZ2V0dGVyKG1vZHVsZS5leHBvcnRzLCAnaW5mbGVjdGlvbnMnLCBpbmZsZWN0aW9ucylcblxuLyoqXG4qIGNsb25lIGFuIG9iamVjdFxuKlxuKi9cbmV4cG9ydCBmdW5jdGlvbiBjbG9uZSAoYmFzZSkge1xuICByZXR1cm4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShiYXNlKSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGh1bWFuaXplIChzKSB7XG4gIHJldHVybiBpbmZsZWN0aW9ucy5odW1hbml6ZShzKS5yZXBsYWNlKC8tfF8vZywgJyAnKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gdGl0bGVpemUgKHMpIHtcbiAgcmV0dXJuIGluZmxlY3Rpb25zLnRpdGxlaXplKGh1bWFuaXplKHMpKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gY2xhc3NpZnkgKHMpIHtcbiAgcmV0dXJuIGluZmxlY3Rpb25zLmNsYXNzaWZ5KHMpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0YWJsZWl6ZSAocykge1xuICByZXR1cm4gaW5mbGVjdGlvbnMudGFibGVpemUocylcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRhYmVsaXplIChzKSB7XG4gIHJldHVybiBpbmZsZWN0aW9ucy50YWJsZWl6ZShzKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gdW5kZXJzY29yZSAocykge1xuICBzID0gcy5yZXBsYWNlKC9cXFxcfFxcLy9nLCAnLScsICcnKVxuICBzID0gcy5yZXBsYWNlKC9bXi1cXHdcXHNdL2csICcnKSAgLy8gcmVtb3ZlIHVubmVlZGVkIGNoYXJzXG4gIHMgPSBzLnJlcGxhY2UoL15cXHMrfFxccyskL2csICcnKSAvLyB0cmltIGxlYWRpbmcvdHJhaWxpbmcgc3BhY2VzXG4gIHMgPSBzLnJlcGxhY2UoJy0nLCAnXycpXG4gIHMgPSBzLnJlcGxhY2UoL1stXFxzXSsvZywgJ18nKSAgIC8vIGNvbnZlcnQgc3BhY2VzIHRvIGh5cGhlbnNcbiAgcyA9IHMudG9Mb3dlckNhc2UoKSAgICAgICAgICAgICAvLyBjb252ZXJ0IHRvIGxvd2VyY2FzZVxuICByZXR1cm4gc1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFyYW1ldGVyaXplIChzKSB7XG4gIHMgPSBzLnJlcGxhY2UoL1xcXFx8XFwvL2csICctJywgJycpXG4gIHMgPSBzLnJlcGxhY2UoL1teLVxcd1xcc10vZywgJycpICAvLyByZW1vdmUgdW5uZWVkZWQgY2hhcnNcbiAgcyA9IHMucmVwbGFjZSgvXlxccyt8XFxzKyQvZywgJycpIC8vIHRyaW0gbGVhZGluZy90cmFpbGluZyBzcGFjZXNcbiAgcyA9IHMucmVwbGFjZSgvWy1cXHNdKy9nLCAnLScpICAgLy8gY29udmVydCBzcGFjZXMgdG8gaHlwaGVuc1xuICBzID0gcy50b0xvd2VyQ2FzZSgpICAgICAgICAgICAgIC8vIGNvbnZlcnQgdG8gbG93ZXJjYXNlXG4gIHJldHVybiBzXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzbHVnaWZ5IChzKSB7XG4gIHMgPSBzLnJlcGxhY2UoL1xcXFx8XFwvL2csICctJywgJycpXG4gIHMgPSBzLnJlcGxhY2UoL1teLVxcd1xcc10vZywgJycpICAvLyByZW1vdmUgdW5uZWVkZWQgY2hhcnNcbiAgcyA9IHMucmVwbGFjZSgvXlxccyt8XFxzKyQvZywgJycpIC8vIHRyaW0gbGVhZGluZy90cmFpbGluZyBzcGFjZXNcbiAgcyA9IHMucmVwbGFjZSgvWy1cXHNdKy9nLCAnLScpICAgLy8gY29udmVydCBzcGFjZXMgdG8gaHlwaGVuc1xuICBzID0gcy50b0xvd2VyQ2FzZSgpICAgICAgICAgICAgIC8vIGNvbnZlcnQgdG8gbG93ZXJjYXNlXG4gIHJldHVybiBzXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzaW5ndWxhcml6ZSAod29yZCkge1xuICByZXR1cm4gaW5mbGVjdGlvbnMuc2luZ3VsYXJpemUod29yZClcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBsdXJhbGl6ZSAod29yZCkge1xuICByZXR1cm4gaW5mbGVjdGlvbnMucGx1cmFsaXplKHdvcmQpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBsYXp5ICh0YXJnZXQsIGF0dHJpYnV0ZSwgZm4sIGVudW1lcmFibGUgPSB0cnVlKSB7XG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGF0dHJpYnV0ZSwge1xuICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICBlbnVtZXJhYmxlOiBlbnVtZXJhYmxlLFxuICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgZGVsZXRlICh0YXJnZXRbYXR0cmlidXRlXSlcblxuICAgICAgaWYgKGVudW1lcmFibGUpIHtcbiAgICAgICAgcmV0dXJuIHRhcmdldFthdHRyaWJ1dGVdID0gZm4uY2FsbCh0YXJnZXQpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsZXQgdmFsdWUgPSBmbi5jYWxsKHRhcmdldClcblxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBhdHRyaWJ1dGUsIHtcbiAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgICBjb25maWd1cmFibGU6IGZhbHNlLFxuICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdmFsdWUgfVxuICAgICAgICB9KVxuXG4gICAgICAgIHJldHVybiB2YWx1ZVxuICAgICAgfVxuICAgIH1cbiAgfSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGxhenlBc3luYyAodGFyZ2V0LCBhdHRyaWJ1dGUsIGZuKSB7XG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGF0dHJpYnV0ZSwge1xuICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIGRlbGV0ZSAodGFyZ2V0W2F0dHJpYnV0ZV0pXG5cbiAgICAgIGxldCByZXN1bHRcblxuICAgICAgKGFzeW5jKCgpID0+IHsgcmVzdWx0ID0gZm4oKSB9KSkoKVxuXG4gICAgICByZXR1cm4gdGFyZ2V0W2F0dHJpYnV0ZV0gPSByZXN1bHRcbiAgICB9XG4gIH0pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmbGF0dGVuIChhcnJheSkge1xuICByZXR1cm4gYXJyYXkucmVkdWNlKChhLCBiKSA9PiBhLmNvbmNhdChiKSwgW10pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzaW5ndWxhcml6ZSAoc3RyaW5nKSB7XG4gIHJldHVybiBpbmZsZWN0aW9ucy5zaW5ndWxhcml6ZShzdHJpbmcpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEZWxlZ2F0b3JzICh0YXJnZXQsIHNvdXJjZSwgb3B0aW9ucyA9IHt9KSB7XG4gIGxldCBleGNsdWRlS2V5cyA9IG9wdGlvbnMuZXhjbHVkZSB8fCBvcHRpb25zLmV4Y2VwdCB8fCBbXVxuICBsZXQgc291cmNlS2V5cyA9IE9iamVjdC5rZXlzKHNvdXJjZSkuZmlsdGVyKGtleSA9PiBleGNsdWRlS2V5cy5pbmRleE9mKGtleSkgPT09IC0xKVxuXG4gIHNvdXJjZUtleXMuZm9yRWFjaChrZXkgPT4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gc291cmNlW2tleV1cbiAgICB9XG4gIH0pKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gdmFsdWVzIChvYmplY3QpIHtcbiAgcmV0dXJuIE9iamVjdC5rZXlzKG9iamVjdCkubWFwKGtleSA9PiBvYmplY3Rba2V5XSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG1peGluICh0YXJnZXQsIHNvdXJjZSkge1xuICB0YXJnZXQgPSB0YXJnZXQucHJvdG90eXBlOyBzb3VyY2UgPSBzb3VyY2UucHJvdG90eXBlXG5cbiAgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgaWYgKG5hbWUgIT09ICdjb25zdHJ1Y3RvcicpIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIG5hbWUsXG4gICAgICBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwgbmFtZSkpXG4gIH0pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhY2Nlc3MgKG9iamVjdCwgZG90dGVkKSB7XG4gIHJldHVybiBkb3R0ZWQuc3BsaXQoJy4nKS5yZWR1Y2UoKG1lbW8sIGN1cnJlbnQpID0+IHtcbiAgICByZXR1cm4gbWVtb1tjdXJyZW50XVxuICB9LCBvYmplY3QpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb3B5UHJvcCAocHJvcGVydHkpIHtcbiAgcmV0dXJuIHtcbiAgICBmcm9tIChzb3VyY2UpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRvICh0YXJnZXQpIHtcbiAgICAgICAgICBsZXQgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBwcm9wZXJ0eSlcblxuICAgICAgICAgIGlmICh0eXBlb2YgKGRlc2MpICE9PSAndW5kZWZpbmVkJyAmJiBkZXNjLmNvbmZpZ3VyYWJsZSkge1xuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgcHJvcGVydHksIGRlc2MpXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBub0NvbmZsaWN0IChmbiwgcHJvdmlkZXIgPSB7fSwgc2NvcGUpIHtcbiAgZm4uc2hvdWxkLmJlLmEuRnVuY3Rpb25cbiAgcHJvdmlkZXIuc2hvdWxkLmJlLmFuLk9iamVjdFxuXG4gIGxldCBzYWZlID0geyB9XG5cbiAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICBPYmplY3Qua2V5cyhwcm92aWRlcikuZm9yRWFjaChnbG9iYWxQcm9wID0+IHtcbiAgICAgIGlmIChnbG9iYWwuaGFzT3duUHJvcGVydHkoZ2xvYmFsUHJvcCkpIHtcbiAgICAgICAgbGV0IGRlc2NyaXB0b3IgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGdsb2JhbCwgZ2xvYmFsUHJvcClcblxuICAgICAgICBpZiAoZGVzY3JpcHRvciAmJiBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSkge1xuICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShzYWZlLCBnbG9iYWxQcm9wLCBkZXNjcmlwdG9yKVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShnbG9iYWwsIGdsb2JhbFByb3AsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IocHJvdmlkZXIsIGdsb2JhbFByb3ApKVxuICAgIH0pXG5cbiAgICBsZXQgcmVzdWx0XG5cbiAgICB0cnkge1xuICAgICAgcmVzdWx0ID0gc2NvcGUgPyBmbi5jYWxsKHNjb3BlKSA6IGZuKClcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXN1bHQgPSAnZXJyb3InXG4gICAgICBjb25zb2xlLmxvZyhlLm1lc3NhZ2UpXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBubyBjb25mbGljdCBmbicsIGUubWVzc2FnZSwgZS5zdGFjaylcbiAgICB9XG5cbiAgICBPYmplY3Qua2V5cyhwcm92aWRlcikuZm9yRWFjaChyZW1vdmUgPT4gZGVsZXRlIChnbG9iYWxbcmVtb3ZlXSkpXG5cbiAgICBPYmplY3Qua2V5cyhzYWZlKS5mb3JFYWNoKHJlc3RvcmUgPT4ge1xuICAgICAgZGVsZXRlIChnbG9iYWxbcmVzdG9yZV0pXG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZ2xvYmFsLCByZXN0b3JlLCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNhZmUsIHJlc3RvcmUpKVxuICAgIH0pXG5cbiAgICByZXR1cm4gcmVzdWx0XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhcnZlIChkYXRhUGF0aCwgcmVzdWx0VmFsdWUsIGluaXRpYWxWYWx1ZSA9IHt9KSB7XG4gIGRvdHBhdGguc2V0KGluaXRpYWxWYWx1ZSwgZGF0YVBhdGgsIHJlc3VsdFZhbHVlKVxuICByZXR1cm4gaW5pdGlhbFZhbHVlXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBsb2FkTWFuaWZlc3RGcm9tRGlyZWN0b3J5IChkaXJlY3RvcnkpIHtcbiAgdmFyIHBhdGggPSByZXF1aXJlKCdwYXRoJylcblx0dmFyIG1hbmlmZXN0ID0gcmVxdWlyZShwYXRoLmpvaW4oZGlyZWN0b3J5LCdwYWNrYWdlLmpzb24nKSkgfHwge31cblx0cmV0dXJuIG1hbmlmZXN0XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0RvbWFpbih2YWx1ZSkgeyByZXR1cm4gdmFsdWUubWF0Y2goRE9NQUlOX1JFR0VYKSB9XG5cbmV4cG9ydCBmdW5jdGlvbiBsb2FkUHJvamVjdEZyb21EaXJlY3RvcnkgKGRpcmVjdG9yeSkge1xuICB2YXIgZXhpc3RzID0gcmVxdWlyZSgnZnMnKS5leGlzdHNTeW5jXG4gIHZhciBwYXRoID0gcmVxdWlyZSgncGF0aCcpXG5cblx0dmFyIG1hbmlmZXN0ID0gbG9hZE1hbmlmZXN0RnJvbURpcmVjdG9yeShkaXJlY3RvcnkpXG5cblx0aWYgKG1hbmlmZXN0LnNreXBhZ2VyICYmIG1hbmlmZXN0LnNreXBhZ2VyLm1haW4pIHtcblx0XHRyZXR1cm4gcmVxdWlyZShcblx0XHRcdHBhdGguam9pbihcblx0XHRcdFx0ZGlyZWN0b3J5LFxuXHRcdFx0XHRtYW5pZmVzdC5za3lwYWdlci5tYWluLnJlcGxhY2UoL15cXC5cXC8vLCAnJylcblx0XHRcdClcblx0XHQpXG5cdH1cblxuXHRpZiAoZXhpc3RzKHBhdGguam9pbihkaXJlY3RvcnksICdza3lwYWdlci5qcycpKSkge1xuXHRcdHJldHVybiByZXF1aXJlKFxuXHRcdFx0cGF0aC5qb2luKGRpcmVjdG9yeSwgJ3NreXBhZ2VyLmpzJylcblx0XHQpXG5cdH1cblxuXHRpZiAoZXhpc3RzKHBhdGguam9pbihkaXJlY3RvcnksICdpbmRleC5qcycpKSkge1xuXHRcdHZhciBwID0gcmVxdWlyZShcblx0XHRcdCBwYXRoLmpvaW4oZGlyZWN0b3J5LCAnaW5kZXguanMnKVxuXHRcdClcblxuXHRcdGlmICghcC5yZWdpc3RyaWVzICYmICFwLmRvY3MpIHtcblx0XHRcdGFib3J0KCdUaGlzIHByb2plY3QgZG9lcyBub3Qgc2VlbSB0byBoYXZlIGEgc2t5cGFnZXIgcHJvamVjdCcpXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHBcblx0fVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNBcnJheShhcmcpIHtcbiAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChhcmcpID09PSAnW29iamVjdCBBcnJheV0nXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1JlZ2V4KHZhbCkge1xuICBpZiAoKHR5cGVvZiB2YWwgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiB0eXBlb2YodmFsKSkgPT09ICdvYmplY3QnICYmIE9iamVjdC5nZXRQcm90b3R5cGVPZih2YWwpLnRvU3RyaW5nKCkgPT09ICcvKD86KS8nKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICByZXR1cm4gZmFsc2U7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmaWx0ZXJRdWVyeSAobm9kZUxpc3QgPSBbXSwgcGFyYW1zKSB7XG4gIGlmICggdHlwZW9mIHBhcmFtcyA9PT0gJ2Z1bmN0aW9uJyApIHtcbiAgICByZXR1cm4gbm9kZUxpc3QuZmlsdGVyKHBhcmFtcylcbiAgfVxuXG4gIHJldHVybiAobm9kZUxpc3QgfHwgW10pLmZpbHRlcihub2RlID0+IHtcbiAgICByZXR1cm4gT2JqZWN0LmtleXMocGFyYW1zKS5ldmVyeShrZXkgPT4ge1xuICAgICAgbGV0IHBhcmFtID0gcGFyYW1zW2tleV1cbiAgICAgIGxldCB2YWx1ZSA9IG5vZGVba2V5XVxuXG4gICAgICBpZiAoaXNSZWdleChwYXJhbSkgJiYgcGFyYW0udGVzdCh2YWx1ZSkpIHtcbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgIH1cblxuICAgICAgaWYgKHR5cGVvZiAocGFyYW0pPT09J3N0cmluZycgJiYgdmFsdWUgPT09IHBhcmFtKSB7XG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgICB9XG5cbiAgICAgIGlmICh0eXBlb2YgKHBhcmFtKT09PSdudW1iZXInICYmIHZhbHVlID09PSBwYXJhbSkge1xuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgfVxuXG4gICAgICAvLyB0cmVhdCBub3JtYWwgYXJyYXlzIHRvIHNlYXJjaCBmb3IgYW55IGV4YWN0IG1hdGNoZXNcbiAgICAgIGlmIChpc0FycmF5KHBhcmFtKSkge1xuICAgICAgICByZXR1cm4gcGFyYW0uYW55KHZhbCA9PiB2YWwgPT09IHZhbHVlKVxuICAgICAgfVxuICAgIH0pXG4gIH0pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhYm9ydChtZXNzYWdlKSB7XG4gICBjb25zb2xlLmxvZyhtZXNzYWdlLnJlZCB8fCBtZXNzYWdlKVxuICAgcHJvY2Vzcy5leGl0KDEpXG59XG5cbiJdfQ==